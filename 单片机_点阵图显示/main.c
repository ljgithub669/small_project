#include<reg51.h>
#include<intrins.h>

sbit SRCLK=P3^6;
sbit RCLK=P3^5;
sbit SER=P3^4;


//--定义要使用的IO口--//
#define COMMONPORTS	P0

//--列选通控制--//
unsigned char code TAB[8]  = {0x7f,0xbf,0xdf,0xef,0xf7,0xfb,0xfd,0xfe};

//--点阵字码--//
unsigned char code CHARCODE[14][8]=
{
/*
{0x00,0x00,0x32,0x49,0x49,0x49,0x3e,0x00}, //9

{0x00,0x00,0x36,0x49,0x49,0x49,0x36,0x00}, //8

{0x00,0x00,0x40,0x40,0x40,0x4f,0x70,0x00}, //7

{0x00,0x00,0x3e,0x49,0x49,0x49,0x26,0x00}, //6

{0x00,0x00,0x72,0x51,0x51,0x51,0x4e,0x00}, //5

{0x00,0x00,0x0c,0x14,0x24,0x7f,0x04,0x00}, //4
*/

{0x00,0x00,0x22,0x49,0x49,0x49,0x36,0x00}, //3

{0x00,0x00,0x27,0x45,0x45,0x45,0x39,0x00}, //2

{0x00,0x00,0x00,0x00,0x21,0x7f,0x01,0x00}, //1

//{0x00,0x00,0x3e,0x41,0x41,0x41,0x3e,0x00}, //0


{0x00,0x3C,0x24,0x24,0xFF,0x24,0x24,0x3C}, //中

{0xFF,0x81,0xAB,0xBF,0xAB,0xAB,0x85,0xFF}, //国 

{0xBF,0xA1,0xFD,0xA1,0xFD,0xA5,0xA1,0xBF}, //西

//{0x00,0x7C,0x54,0x54,0xFF,0x55,0x55,0x7C}, //电

{0x7C,0x54,0x54,0xFF,0x55,0x55,0x7D,0x02},	//电

//{0x10,0x10,0x94,0x92,0xBF,0xD0,0x90,0x10}, //子

{0x81,0x42,0x24,0x18,0x18,0x24,0x42,0x81}, //X

{0x00,0x00,0xFF,0x81,0x81,0x42,0x3C,0x00}, //D

{0x00,0xFC,0x02,0x02,0x02,0x02,0xFC,0x00}, //U

{0x48,0x52,0x6B,0xFF,0x6A,0x52,0x48,0x00}, //李

{0x00,0x4A,0x50,0x62,0xF8,0x62,0x50,0x4A}, //杰

{0x00,0xFE,0x02,0x02,0x02,0x00,0xBE,0x00}, //Li

{0x00,0x02,0x02,0xBE,0x00,0xBE,0x00,0x00}  //Ji



};
void delay(unsigned int time)
{
  unsigned int i,j;
  for(i=0;i<time;i++)
    for(j=0;j<121;j++);
}


void Hc595SendByte(unsigned char dat)
{
	unsigned char a;
	SRCLK=0;
	RCLK=0;
	for(a=0;a<8;a++)
	{
		SER=dat>>7;
		dat<<=1;

		SRCLK=1;
		_nop_();
		_nop_();
		SRCLK=0;	
	}

	RCLK=1;
	_nop_();
	_nop_();
	RCLK=0;
}

void main()
{	
 	unsigned char tab, j;
	unsigned int  i;

	while(1)
	{	
		for(i= 0; i<80; i++ )   //两个字之间的扫描间隔时间
		{
			for(tab=0;tab<8;tab++)
			{	
				Hc595SendByte(0x00);			     //消隐																
				COMMONPORTS	= TAB[tab];				 //输出字码	
				Hc595SendByte(CHARCODE[j][tab]);	
				delay(2);		
			}
			 
		}
		j++;
		if(j == 14)
		{
			j = 0;
		}
	}	
}
